
# Copyright (c) 2013-2014, EPFL/Blue Brain Project
#                     Raphael Dumusc <raphael.dumusc@epfl.ch>

cmake_minimum_required(VERSION 2.8)
project(DisplayCluster)
list(APPEND CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/CMake
                              ${CMAKE_SOURCE_DIR}/CMake/common)
include(GitExternal)

# Versioning
set(VERSION_MAJOR 0)
set(VERSION_MINOR 4)
set(VERSION_PATCH 0)
set(VERSION_ABI 0)

#set(CMAKE_CXX_FLAGS "-Wall -ftemplate-depth-1024")
# Scripts
set(PROJECT_INCLUDE_NAME dc)
set(DISPLAYCLUSTER_DESCRIPTION "The DisplayCluster project")
set(DISPLAYCLUSTER_ISSUES_URL "https://bbpteam.epfl.ch/project/issues/browse/DISCL")
set(DISPLAYCLUSTER_PACKAGE_URL "https://github.com/BlueBrain/DisplayCluster/releases")
include(Common)
include(FindPackages) # Generated by Buildyard and checked in

# Remove preprocessor #error warnings of cppcheck which happen in PDF.cpp and PictureFlow.cpp.
# The -D option in TargetHooks.cmake seems to overwrites other #defines and causes the problem.
list(APPEND CPPCHECK_EXTRA_ARGS --suppress=preprocessorErrorDirective)

# Build options

# Fix for avutil: https://code.google.com/p/ffmpegsource/source/detail?r=311
add_definitions(-D__STDC_CONSTANT_MACROS)

option(FORCE_BUILD_DCCORE "Force build the core library" OFF)

if(OPENGL_FOUND AND MPI_FOUND AND FFMPEG_FOUND AND FCGI_FOUND)
  include_directories(SYSTEM ${MPI_INCLUDE_PATH})
  set(BUILD_CORE_LIBRARY ON)
else()
  if(FORCE_BUILD_DCCORE)
    message(FATAL_ERROR "One of OpenGL MPI ffmpeg fcgi was not found. Not building core library!")
  else()
    message(STATUS "One of OpenGL MPI ffmpeg fcgi was not found. Not building core library!")
  endif()
endif()

#<<<<<<< HEAD
# Core library
#find_package(OpenGL)
#find_package(MPI)
#find_package(FFMPEG)
#if(OPENGL_FOUND AND MPI_FOUND AND FFMPEG_FOUND)
#  add_subdirectory(src)
#  set(DISPLAYCLUSTER_LIBRARY_BUILT TRUE)

#  # install launchers
#  install(PROGRAMS examples/startdisplaycluster DESTINATION bin)
#  install(PROGRAMS examples/displaycluster.py DESTINATION bin)

#  # install data files
#  install(DIRECTORY data DESTINATION .)
#=======
if(TUIO_FOUND)
  option(ENABLE_TUIO_TOUCH_LISTENER "Enable TUIO touch listener for multi-touch events" ON)
endif()
#>>>>>>> upstream/master

if(POPPLER_FOUND)
  option(ENABLE_PDF_SUPPORT "Enable Pdf support using Poppler" ON)
endif()

include_directories(src)

# Targets
add_subdirectory(src)
add_subdirectory(apps)
add_subdirectory(tests)

# Documentation
set(COMMON_PROJECT_DOMAIN ch.epfl.bluebrain)
include(DoxygenRule)
add_subdirectory(doc)

# Install example files
install(DIRECTORY examples DESTINATION share/DisplayCluster COMPONENT examples)
